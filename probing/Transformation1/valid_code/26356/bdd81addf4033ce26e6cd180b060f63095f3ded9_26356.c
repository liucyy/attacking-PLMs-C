static void vfio_msix_enable(VFIOPCIDevice *vdev)

{

    vfio_disable_interrupts(vdev);



    vdev->msi_vectors = g_malloc0(vdev->msix->entries * sizeof(VFIOMSIVector));



    vdev->interrupt = VFIO_INT_MSIX;



    

    vfio_msix_vector_do_use(&vdev->pdev, 0, NULL, NULL);

    vfio_msix_vector_release(&vdev->pdev, 0);



    if (msix_set_vector_notifiers(&vdev->pdev, vfio_msix_vector_use,

                                  vfio_msix_vector_release, NULL)) {

        error_report("vfio: msix_set_vector_notifiers failed");

    }



    trace_vfio_msix_enable(vdev->vbasedev.name);

}